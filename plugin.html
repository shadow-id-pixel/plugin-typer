<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <style>
        :root { 
            --bg: #f5f5f5; 
            --accent: #0078d4; 
            --text: #333; 
            --border: #ddd; 
            --row-hover: #e9e9e9;
            --row-active: #cce4f7;
        }
        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; padding: 0; margin: 0; font-size: 13px; user-select: none; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        
        /* Navigation - Lebih Cerah */
        .top-nav { display: flex; gap: 4px; padding: 8px; background: #fff; border-bottom: 1px solid var(--border); box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .btn-main { background: var(--accent); color: white; border: none; padding: 10px; flex: 1; cursor: pointer; font-weight: bold; border-radius: 4px; font-size: 14px; }
        .btn-main:hover { background: #005a9e; }
        .btn-sec { background: #eee; border: 1px solid #ccc; color: #333; padding: 8px; cursor: pointer; border-radius: 4px; }

        /* Input */
        textarea { width: 100%; height: 90px; background: #fff; color: #000; border: none; border-bottom: 2px solid var(--accent); padding: 10px; box-sizing: border-box; resize: none; font-family: 'Consolas', monospace; font-size: 13px; outline: none; }
        
        /* List - Terang & Font Lebih Besar */
        .list-box { flex: 1; overflow-y: auto; background: #fff; }
        .row { display: flex; align-items: center; border-bottom: 1px solid #eee; padding: 10px 15px; cursor: pointer; transition: 0.2s; }
        .row:hover { background: var(--row-hover); }
        .row.active { background: var(--row-active); border-left: 4px solid var(--accent); color: #000; font-weight: 500; }
        .num { color: #999; width: 35px; font-size: 11px; }
        .content { flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-size: 13px; }
        .tag { color: #d4a017; margin-right: 8px; font-weight: bold; }

        /* Footer */
        .footer { background: #eee; padding: 8px; font-size: 10px; color: #666; border-top: 1px solid var(--border); text-align: center; font-weight: 500; }
        .footer a { color: var(--accent); text-decoration: none; }
    </style>
</head>
<body>
    <div class="top-nav">
        <button class="btn-main" onclick="sendText()">+ Paste & Next</button>
        <button class="btn-sec">Align</button>
        <button class="btn-sec">âš™</button>
    </div>

    <textarea id="input" oninput="renderLines()" placeholder="Paste script manhwa di sini..."></textarea>

    <div class="list-box" id="list"></div>

    <div class="footer">
        typer for photopea ( inspired by <a href="https://typer.hayasaku.fr" target="_blank">typer.hayasaku.fr</a> )
    </div>

    <script>
        let selectedIndex = -1;
        let linesData = [];

        function renderLines() {
            const val = document.getElementById('input').value;
            linesData = val.split('\n').filter(l => l.trim() !== "");
            const list = document.getElementById('list');
            list.innerHTML = '';

            linesData.forEach((line, i) => {
                let div = document.createElement('div');
                div.className = 'row';
                div.id = 'row-' + i;
                
                let match = line.match(/^([A-Z()]+):(.*)/);
                let tag = match ? match[1] + ":" : "";
                let txt = match ? match[2] : line;

                div.innerHTML = `<span class="num">${i + 1}</span><span class="content"><span class="tag">${tag}</span>${txt}</span>`;
                
                div.onclick = () => selectRow(i);
                list.appendChild(div);
            });
        }

        function selectRow(index) {
            selectedIndex = index;
            document.querySelectorAll('.row').forEach(r => r.classList.remove('active'));
            const activeRow = document.getElementById('row-' + index);
            if (activeRow) {
                activeRow.classList.add('active');
                activeRow.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
        }

        function sendText() {
            if(selectedIndex === -1 || !linesData[selectedIndex]) return;

            let line = linesData[selectedIndex];
            let match = line.match(/^([A-Z()]+):(.*)/);
            let cleanText = match ? match[2].trim() : line.trim();

            const ppeaScript = `
                var doc = app.activeDocument;
                var layer = doc.artLayers.add();
                layer.kind = LayerKind.TEXT;
                var ti = layer.textItem;
                
                ti.contents = "${cleanText.replace(/"/g, '\\"').replace(/\n/g, '\\r')}";
                ti.size = 50; // Ukuran font x2 (50px)
                ti.justification = Justification.CENTER;

                try {
                    var selection = doc.selection.bounds;
                    var x = (selection[0] + selection[2]) / 2;
                    var y = (selection[1] + selection[3]) / 2;
                    ti.position = [x, y];
                } catch(e) {
                    ti.position = [doc.width / 2, doc.height / 2];
                }
            `;
            window.parent.postMessage(ppeaScript, "*");

            // OTOMATIS PINDAH KE BARIS BERIKUTNYA
            if (selectedIndex < linesData.length - 1) {
                selectRow(selectedIndex + 1);
            }
        }
    </script>
</body>
</html>
