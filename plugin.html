<!DOCTYPE html>
<html>
<head>
    <style>
        body { background: #333; color: white; font-family: 'Segoe UI', sans-serif; padding: 10px; margin: 0; font-size: 13px; }
        .header { display: flex; gap: 5px; margin-bottom: 10px; }
        button { background: #0078d4; color: white; border: none; padding: 8px 15px; cursor: pointer; border-radius: 2px; flex-grow: 1; }
        button:hover { background: #005a9e; }
        
        textarea { width: 100%; height: 80px; background: #222; color: #eee; border: 1px solid #555; box-sizing: border-box; padding: 5px; font-family: monospace; }
        
        .list-container { border: 1px solid #555; height: 200px; overflow-y: auto; margin-top: 10px; background: #282828; }
        .line-item { padding: 8px; border-bottom: 1px solid #3c3c3c; cursor: pointer; display: flex; gap: 10px; align-items: center; }
        .line-item:hover { background: #3d3d3d; }
        .line-num { color: #888; font-size: 11px; min-width: 20px; }
        .line-content { flex-grow: 1; }
        .line-tag { color: #ffca28; font-weight: bold; }

        .style-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; margin-top: 10px; }
        .style-btn { background: #444; text-align: left; padding: 5px 10px; font-size: 11px; border-left: 3px solid #0078d4; }
        .style-btn:hover { background: #555; }
    </style>
</head>
<body>
    <div class="header">
        <button onclick="applyToPhotopea()">Paste</button>
        <button style="background:#555">Align</button>
    </div>

    <textarea id="scriptInput" oninput="parseScript()" placeholder="Masukkan skrip di sini..."></textarea>

    <div class="list-container" id="lineList">
        </div>

    <div style="margin-top: 15px; font-weight: bold; border-bottom: 1px solid #555;">Styles</div>
    <div class="style-grid">
        <div class="style-btn" onclick="setStyle('Ngomong')">ngomong</div>
        <div class="style-btn" onclick="setStyle('Berpikir')">berpikir</div>
        <div class="style-btn" onclick="setStyle('Teriak')"><b>TERIAK</b></div>
        <div class="style-btn" onclick="setStyle('Box')">BOX</div>
    </div>

    <script>
        let selectedText = "";

        function parseScript() {
            const input = document.getElementById("scriptInput").value;
            const lines = input.split('\n');
            const listDiv = document.getElementById("lineList");
            listDiv.innerHTML = "";

            lines.forEach((line, index) => {
                if (line.trim() === "") return;
                
                let div = document.createElement("div");
                div.className = "line-item";
                
                // Deteksi tag seperti (): atau OT:
                let match = line.match(/^([A-Z()]+):(.*)/);
                let tag = match ? match[1] + ":" : "";
                let content = match ? match[2] : line;

                div.innerHTML = `<span class="line-num">${index + 26}</span>
                                 <span class="line-content"><span class="line-tag">${tag}</span>${content}</span>`;
                
                div.onclick = () => {
                    // Highlight pilihan
                    document.querySelectorAll('.line-item').forEach(el => el.style.background = "");
                    div.style.background = "#004a82";
                    selectedText = content.trim();
                };
                listDiv.appendChild(div);
            });
        }

        function applyToPhotopea() {
            if (!selectedText) {
                alert("Pilih baris teks dulu!");
                return;
            }

            const script = `
                var doc = app.activeDocument;
                var layer = doc.artLayers.add();
                layer.kind = LayerKind.TEXT;
                var textItem = layer.textItem;
                textItem.contents = "${selectedText.replace(/"/g, '\\"')}";
                textItem.size = 25;
                textItem.justification = Justification.CENTER;
            `;
            window.parent.postMessage(script, "*");
        }

        function setStyle(styleName) {
            // Logika untuk mengubah font sesuai style bisa ditambahkan di sini
            console.log("Style set to: " + styleName);
        }
    </script>
</body>
</html>
